{% extends 'base.html.twig' %}

{% block title %}Salles â€” Admin RoomBooking{% endblock %}

{% block stylesheets %}
{# besoins tous ces 3 fichiers CSS => je rÃ©utilise les mÃªmes Ã©lÃ©ments!!  #}
    <link rel="stylesheet" href="{{ asset('styles/admin.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/rooms.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/classes.css') }}">
{% endblock %}

{% block body %}
<div class="container-fluid px-4 py-3 mt-3">
    
    {# ---- Header ---- #}
    <div class="dashboard-header">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <div class="d-flex align-items-center gap-2 mb-2">
                    <span class="badge-admin">Administrateur</span>
                </div>
                <div class="d-flex align-items-center gap-2 mb-1">
                    <a href="{{ path('app_admin_dashboard') }}" class="breadcrumb-link">Dashboard</a>
                    <span class="breadcrumb-sep">â€º</span>
                    
                    <span class="breadcrumb-current">Classes</span>
                </div>
                <h1>Gestion des classes</h1>
                <p>{{ classes|length }} classe{{ classes|length > 1 ? 's' : '' }} enregistrÃ©e{{ classes|length > 1 ? 's' : '' }}</p>
            </div>
            <div>
                {# TÃ¢che 7 : bouton vers CrÃ©er une classe #}
                <a href="{{ path('app_admin_classe_new') }}" class="btn-action-primary text-decoration-none d-inline">+ CrÃ©er une classe</a>
            </div>
        </div>
    </div>

     {# ---- Liste des salles ---- #}
    {% if classes is empty %}
        <div class="empty-state">
            <div class="empty-icon">ðŸŽ“</div>
            <p>Aucune classe enregistrÃ©e.</p>
            <a href="#" class="btn-action-primary text-decoration-none d-inline">CrÃ©er la premiÃ¨re classe</a>
        </div>
    {% else %}
        <div class="row g-3">
            {% for classe in classes %}
                <div class="col-md-6 col-lg-4">
                    <div class="classe-card shadow">

                        {# En-tÃªte de la card #}
                        <div class="classe-card-header d-flex align-items-start justify-content-between">
                            <div>
                                <div class="classe-card-name">{{ classe.name }}</div>
                                <div class="classe-card-count">
                                    ðŸ‘¨â€ðŸŽ“ {{ classe.students|length }} Ã©tudiant{{ classe.students|length > 1 ? 's' : '' }}
                                </div>
                            </div>

                            {# badge vide/none vide #}
                            {% if classe.students is empty %}
                                <span class="classe-badge classe-badge-empty">Vide</span>
                            {% else %}
                                <span class="classe-badge classe-badge-active">Active</span>
                            {% endif %}  
                        </div>

                        {# aprÃ§u des Ã©tudiants => max 3 #}
                        {% if classe.students is not empty %}
                            <div class="classe-card-students">
                                {% for student in classe.students|slice(0, 3) %}
                                    <span class="student-chip">
                                        {{ student.user.firstname }} {{ student.user.lastname }}
                                    </span>
                                {% endfor %}

                                {% if classe.students|length > 3 %}
                                    <span class="student-chip-more">
                                        + {{ classe.students|length - 3 }} autres
                                    </span>
                                {% endif %}
                            </div>
                        {% endif %}

                        {# actions #}
                        <div class="classe-card-actions d-flex gap-2">
                            {# tÃ¢che 6: voir le dÃ©tail #}
                            <a href="{{ path('app_admin_classe_show', {id: classe.id}) }}" class="btn-action-secondary flex-fill text-center text-decoration-none d-inline">Voir le dÃ©tail</a>
                        
                            {# TÃ¢che 8+1 => modifier le nom de la classe #}
                            <a href="{{ path('app_admin_classe_edit', {id: classe.id}) }}" class="btn-action-primary text-decoration-none d-inline">Modifier</a>


                            {# tÃ¢che 8: supprimer seulement si elle est vide #}
                            {% if classe.students is empty %}
                                {# <a href="#" class="btn-action-danger flex-fill text-center">ðŸ—‘ Supprimer</a> #}
                                {{ include('partials/_delete_classe.html.twig', { classe: classe }) }}
                            {% else %}
                                <span class="btn-action-disabled" title="Classe non vide">ðŸ—‘ Supprimer</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
            {% endfor %}
        </div>
    {% endif %}
<div>

{% endblock %}