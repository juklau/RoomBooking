{% extends 'base.html.twig' %}

{% block title %}{{ classe.name }} â€” Admin RoomBooking{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles/admin.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/rooms.css') }}">
    <link rel="stylesheet" href="{{ asset('styles/classes.css') }}">
{% endblock %}

{% block body %}
<div class="container-fluid px-4 py-3 mt-3">

    {# ---- Header ---- #}
    <div class="dashboard-header">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <div class="d-flex align-items-center gap-2 mb-2">
                    <span class="badge-admin">Administrateur</span>
                </div>
                <div class="d-flex align-items-center gap-2 mb-1">
                    <a href="{{ path('app_admin_dashboard') }}" class="breadcrumb-link">Dashboard</a>
                    <span class="breadcrumb-sep">â€º</span>

                    <a href="{{ path('app_admin_classes') }}" class="breadcrumb-link">Classes</a>
                    <span class="breadcrumb-sep">â€º</span>
                    
                    <span class="breadcrumb-current">{{ classe.name }}</span>
                </div>
                <h1>{{ classe.name }}</h1>
                <p>{{ classe.students|length }} Ã©tudiant{{ classe.students|length > 1 ? 's' : '' }}</p>
            </div>
            <div class="d-flex gap-2">

                {# TÃ¢che 9 : ajouter un Ã©tudiant Ã  cette classe #}
                <a href="{{ path('app_admin_classe_add_student', {id: classe.id}) }}" class="btn-action-primary text-decoration-none d-inline">+ Ajouter un Ã©tudiant</a>
                
                {# TÃ¢che 14: ajouter un coordinateur Ã  une classe #}
                <a href="{{ path('app_admin_classe_add_coordinator', {id: classe.id}) }}" class="btn-action-primary text-decoration-none d-inline">
                    + Ajouter un coordinateur
                </a>

                {# TÃ¢che 8+1 => modifier le nom de la classe #}
                <a href="{{ path('app_admin_classe_edit', {id: classe.id}) }}" class="btn-action-primary text-decoration-none d-inline">Modifier</a>

                {# TÃ¢che 8 : supprimer la classe (seulement si vide) #}
                {{ include('partials/_delete_classe.html.twig', { classe: classe }) }}
            </div>
        </div>
    </div>

    <div class="row g-4">

        {# ---- infos principales ---- #}
        <div class="col-lg-4">
            <div class="detail-card shadow">
                <div class="detail-card-title">ğŸ“‹ Informations</div>

                <div class="detail-row">
                    <span class="detail-label">Nom</span>
                    <span class="detail-value">{{ classe.name }}</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Nombre d'Ã©tudiants</span>
                    <span class="detail-value">{{ classe.students|length }}</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Coordinateurs</span>
                    <span class="detail-value">{{ classe.coordinators is defined ? classe.coordinators|length : 0 }}</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Statut</span>
                    <span class="detail-value">
                        {% if classe.students is empty %}
                            <span class="classe-badge classe-badge-empty">Vide</span>
                        {% else %}
                            <span class="classe-badge classe-badge-active">Active</span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        {# ---- colonne droite: liste des Ã©tudiants et liste de coordinateurs ---- #}
        <div class="col-lg-8 d-flex flex-column gap-4">

            {#  Liste des Ã©tudiants #}
            <div class="detail-card shadow">
                <div class="detail-card-title d-flex align-items-center justify-content-between">
                    <span>ğŸ‘¨â€ğŸ“ Ã‰tudiants</span>
                    <span class="detail-count">{{ classe.students|length }}</span>
                </div>

                {% if classe.students is empty %}
                    <div class="empty-state-sm mt-2">
                        <p>Aucun Ã©tudiant dans cette classe.</p>
                        <a href="{{ path('app_admin_classe_add_student', {id: classe.id}) }}" class="btn-action-primary text-decoration-none d-inline">+ Ajouter un Ã©tudiant</a>
                    </div>
                {% else %}
                    <div class="students-list">
                        {% for student in classe.students %}
                            <div class="student-list-row d-flex align-items-center justify-content-between px-3">
                                <div class="d-flex align-items-center gap-3">

                                    {# Avatar avec initiales #}
                                    <div class="student-avatar-lg">
                                        {{ student.user.firstname|first|upper }}{{ student.user.lastname|first|upper }}
                                    </div>
                                    <div>
                                        <div class="student-fullname">
                                            {{ student.user.firstname }} {{ student.user.lastname }}
                                        </div>
                                        <div class="student-email">{{ student.user.email }}</div>
                                    </div>
                                </div>
                                <div class="d-flex gap-4">
                                    {# TÃ¢che 11 : rÃ©initialiser mot de passe #}
                                    <a href="{{ path('app_admin_student_reset_password', {id: student.id}) }}" class="btn-action-secondary btn-sm-action"
                                       title="RÃ©initialiser le mot de passe">
                                        ğŸ”‘
                                    </a>
                                    {# TÃ¢che 12 : retirer l'Ã©tudiant #}
                                    {# <a href="#" class="btn-action-danger btn-sm-action" title="Supprimer l'Ã©tudiant"> ğŸ—‘</a> #}
                                    {{ include('partials/_remove_student_classe_admin.html.twig', { student: student, classe: classe }) }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            {# liste des coordinateurs #}
            <div class="detail-card shadow">
                <div class="detail-card-title d-flex align-items-center justify-content-between">
                    <span>ğŸ‘¨â€ğŸ« Coordinateurs</span>
                    <span class="detail-count">{{ classe.coordinators|length }}</span>
                </div>

                {% if classe.coordinators is empty %}
                    <div class="empty-state-sm">
                        <p>Aucun coordinateur assignÃ© Ã  cette classe.</p>
                        <a href="{{ path('app_admin_classe_add_coordinator', {id: classe.id}) }}" class="btn-action-primary text-decoration-none d-inline">+ Ajouter un coordinateur</a>
                    </div>
                {% else %}
                    <div class="coordinators-list">
                        {% for coordinator in classe.coordinators %}
                            <div class="coordinator-list-row d-flex align-items-center justify-content-between px-3">
                                <div class="d-flex align-items-center gap-3">

                                    {# Avatar avec initiales #}
                                    <div class="coordinator-avatar-lg">
                                        {{ coordinator.user.firstname|first|upper }} {{ coordinator.user.lastname|first|upper }}
                                    </div>
                                    <div>
                                        <div class="coordinator-fullname">
                                            {{ coordinator.user.firstname }} {{ coordinator.user.lastname }}
                                        </div>
                                        <div class="coordinator-email">{{ coordinator.user.email }}</div>
                                    </div>
                                </div>
                                <div class="d-flex gap-4">
                                    {# TÃ¢che 15 : rÃ©initialiser mot de passe #}
                                    <a href="{{ path('app_admin_coordinator_reset_password', {id: coordinator.id}) }}" class="btn-action-secondary btn-sm-action"
                                       title="RÃ©initialiser le mot de passe">
                                        ğŸ”‘
                                    </a>
                                    {# TÃ¢che 16 : retirer le coordinateur #} 
                                    {# <a href="#" class="btn-action-danger btn-sm-action" title="Supprimer le cordinateur"> ğŸ—‘</a> #}
                                    {{ include('partials/_remove_coordinator_classe.html.twig', { coordinator: coordinator, classe: classe }) }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

        </div>

    </div>

    {# ---- Retour ---- #}
    <div class="mt-5">
        <a href="{{ path('app_admin_classes') }}" class="btn-action-secondary text-decoration-none d-inline">
            â† Retour Ã  la liste
        </a>
    </div>

</div>
{% endblock %}
